# MT Project Configuration (CosmeticaBar)
# Полная конфигурация на основе MyGoogleScripts/EcosystemLib/01Config.js

project:
  code: mt
  name: CosmeticaBar
  description: Project with testers and samples - full feature set

# Google Sheets
spreadsheet:
  id: "YOUR_MT_SPREADSHEET_ID_HERE"

# ============================================================
# Реестр листов (SHEETS)
# ============================================================
sheets:
  primary: "Главная"
  certification: "Сертификация"
  labels: "Этикетки"
  news: "New sert"
  invoice_full: "Для таможни"
  order: "Ордер"
  order_form: "Заказ"
  price: "Прайс"
  stocks: "-остатки"
  price_dynamics: "Динамика цены"
  price_calculation: "Расчет цены"
  abc_analysis: "ABC-Анализ"
  tz_by_status: "ТЗ по статусам"
  order_verification: "Сверка заказа"
  for_database: "Для базы"
  local_lookup: "Вид и код"
  rules: "Правила синхро"
  log: "Журнал синхро"
  log_debug: "Журнал логов"
  external_docs: "Внешние документы"

# Листы для автосоздания строк при новом артикуле
base_sheets_for_creation:
  - "Сертификация"
  - "Этикетки"
  - "Заказ"
  - "Динамика цены"
  - "Расчет цены"
  - "ABC-Анализ"

# ============================================================
# Колонки листа "Главная" (PRIMARY)
# ============================================================
columns:
  primary:
    - "ID"
    - "ID-P"
    - "Статус"
    - "Примечание/записная книжка"
    - "Арт. Рус"
    - "Арт. произв."
    - "Код база"
    - "Код в 1С"
    - "Название  ENG прайс произв"
    - "Наименования англ по ДС"
    - "Наименования рус по ДС"
    - "Объём"
    - "Форма выпуска"
    - "шт./уп."
    - "Категория товара"
    - "Линия"
    - "Группа"
    - "BAR CODE"
    - "ID-G"
    - "ID-L"

  certification:
    - "ID"
    - "Статус"
    - "Наименования англ по ДС"
    - "Наименования рус по ДС"
    - "Наименование ДС"
    - "Объём"
    - "Наименование для инвойса"
    - "Объём англ."
    - "Наименование для инвойса Англ"
    - "Примечание/записная книжка"
    - "Арт. Рус"
    - "Арт. произв."
    - "Код база"
    - "Код в 1С"
    - "BAR CODE"
    - "код категории"
    - "категория"
    - "Вид продукции"
    - "Код ТН ВЭД"
    - "ДС"
    - "ДС до"
    - "номер ДС"
    - "Протокол ДС"
    - "Протокол доп"
    - "Скан спирт"
    - "Спирт До"
    - "INCI"
    - "COA"
    - "Этикетка"

  labels:
    - "ID"
    - "Статус"
    - "Арт. Рус"
    - "Категория товара"
    - "Объём"
    - "Наименования рус по ДС"
    - "Наименования англ по ДС"
    - "Назначение Этикетка"
    - "Применение Этикетка"
    - "Активные ингредиенты без %"
    - "описание БУКЛЕТ"
    - "применение БУКЛЕТ"
    - "состав БУКЛЕТ"
    - "История статусов"

  invoice_full:
    - "ID"
    - "Арт. Рус"
    - "Арт. произв."
    - "Наименование"
    - "Наименование Англ"
    - "кол-во"
    - "Цена ед."
    - "Сумма"
    - "ДС"
    - "ДС до"
    - "номер ДС"
    - "Спирт"
    - "Спирт до"
    - "статус"
    - "Примечание"
    - "Назначение Этикетка"
    - "Применение Этикетка"
    - "Активные ингредиенты без %"

  order_form:
    - "ID"
    - "ID-P"
    - "Статус"
    - "Арт. Рус"
    - "Арт. произв."
    - "Название  ENG прайс произв"
    - "Наименования рус по ДС"
    - "Объём"
    - "шт./уп."
    - "ПРОДАЖИ"
    - "Остаток"
    - "товар в  ПУТИ"
    - "Остаток 1"
    - "СГ 1"
    - "Остаток 2"
    - "СГ 2"
    - "Остаток3"
    - "СГ 3"
    - "СПИСАНО"
    - "РЕЗЕРВ"
    - "Среднемесячные продажи, шт"
    - "Потребность на 6 месяцев, шт"
    - "На сколько мес запас"
    - "Необходимо заказать, шт"
    - "Предварительный заказ"
    - "заказ в упаковках"
    - "ЗАКАЗ"
    - "EXW  ALFASPA  текущая, €"
    - "Предварительная сумма заказа 0,00 €"
    - "АКЦИИ"
    - "условие#"
    - "коментарий#"
    - "Срок#"
    - "Набор"
    - "условие"
    - "коментарий"
    - "Срок"
    - "Добавить в прайс"
    - "Категория товара"
    - "Группа линии"
    - "Линия Прайс"
    - "Примечание"
    - "Продублировать"

  price:
    - "ID"
    - "ID-L"
    - "Статус"
    - "Категория товара"
    - "Код база"
    - "Арт. Рус"
    - "Наименование"
    - "Примечание"
    - "Объём"
    - "Для"
    - "Картинка"
    - "Картинка 2"
    - "Цена"
    - "RRP"
    - "Е-comerc"
    - "Группа линии"
    - "Линия Прайс"
    - "Продублировать"
    - "Линия Рус"

  price_dynamics:
    - "ID"
    - "ID-P"
    - "Статус"
    - "Арт. Рус"
    - "Арт. произв."
    - "Код база"
    - "Код в 1С"
    - "Название  ENG прайс произв"
    - "Наименования англ по ДС"
    - "Наименования рус по ДС"
    - "Объём"
    - "ЦЕНА EXW из Б/З"
    - "Комментарий"
    - "EXW 2025, €"
    - "СКИДКА ОТ EXW 2025, %"
    - "EXW ALFASPA 2025, €"
    - "Закупочная цена 2025, ₽"
    - "DDP-МОСКВА 2025, ₽"
    - "Прирост EXW, €"
    - "Прирост DDP-МОСКВА, ₽"

  price_calculation:
    - "ID"
    - "ID-P"
    - "Статус"
    - "Арт. Рус"
    - "Арт. произв."
    - "Код база"
    - "Код в 1С"
    - "Название  ENG прайс произв"
    - "Наименования англ по ДС"
    - "Наименования рус по ДС"
    - "Объём"
    - "ЦЕНА EXW из Б/З"
    - "Комментарий"
    - "EXW  предыдущая, €"
    - "EXW  текущая, €"
    - "EXW  ALFASPA  текущая, €"
    - "Закупочная цена, ₽"
    - "DDP  -МОСКВА,  ₽"

# ============================================================
# Маппинг колонок (логическое имя → текст заголовка)
# ============================================================
column_mapping:
  # Общие
  id: "ID"
  id_p: "ID-P"
  id_g: "ID-G"
  id_l: "ID-L"
  status: "Статус"
  note: "Примечание/записная книжка"

  # Артикулы
  article_rus: "Арт. Рус"
  article_producer: "Арт. произв."
  code_base: "Код база"
  code_1c: "Код в 1С"
  barcode: "BAR CODE"

  # Названия
  name_eng_price: "Название  ENG прайс произв"
  name_eng_ds: "Наименования англ по ДС"
  name_rus_ds: "Наименования рус по ДС"
  name_ds: "Наименование ДС"
  name_invoice: "Наименование для инвойса"
  name_invoice_en: "Наименование для инвойса Англ"

  # Характеристики
  volume: "Объём"
  volume_en: "Объём англ."
  form: "Форма выпуска"
  units_per_pack: "шт./уп."
  category: "Категория товара"
  line: "Линия"
  group: "Группа"

  # Цены
  price_exw: "ЦЕНА EXW из Б/З"
  price_exw_current: "EXW  текущая, €"
  price_exw_alfaspa: "EXW  ALFASPA  текущая, €"
  price_purchase: "Закупочная цена, ₽"
  price_ddp: "DDP  -МОСКВА,  ₽"
  rrp: "RRP"

  # Сертификация
  tn_ved: "Код ТН ВЭД"
  product_type: "Вид продукции"
  ds_link: "ДС"
  ds_until: "ДС до"
  ds_number: "номер ДС"
  spirit_scan: "Скан спирт"
  spirit_until: "Спирт До"
  inci_link: "INCI"
  coa_link: "COA"
  label_link: "Этикетка"

  # Этикетки
  purpose_label: "Назначение Этикетка"
  application_label: "Применение Этикетка"
  active_ingredients: "Активные ингредиенты без %"

# ============================================================
# Parser settings - ТРИ РЕЖИМА ОБРАБОТКИ
# ============================================================
parser:
  # Режим 1: Основной прайс (Б/З поставщик)
  main:
    type: mt_main
    function: processMtMainPrice
    sheet_name: "Прайс"
    header_row: 1
    # Индексы колонок в Excel поставщика
    excel_columns:
      CODE: 0           # Арт. произв.
      CATEGORY: 1       # (определяет группу)
      DESCRIPTION: 2    # Название ENG
      FORMAT: 3         # Объём
      UNITS: 4          # шт./уп.
      PRICE: 5          # Цена EXW
      EAN: 6            # BAR CODE
    # Логика определения группы:
    # if CODE exists AND CATEGORY empty → это строка группы
    # if CODE exists AND DESCRIPTION exists → это артикул
    group_detection:
      condition: "code_exists_and_category_empty"

  # Режим 2: Тестеры
  tester:
    type: mt_tester
    function: processMtTesterPrice
    # Трансформации:
    transformations:
      volume_prefix: "-Тестер "     # Добавляется к объёму
      group_suffix: " - Тестер"     # Добавляется к группе
    # Особенности:
    continue_idp_numbering: true    # НЕ очищает ID-P, продолжает нумерацию
    price_multiplier: 1             # Без множителя

  # Режим 3: Пробники
  samples:
    type: mt_samples
    function: processMtSamplesPrice
    # Трансформации:
    transformations:
      group_suffix: " - пробник"    # Добавляется к группе
    # Особенности:
    price_multiplier: 10            # ВАЖНО: цена × 10
    update_statuses_after: true     # Вызывает updateStatusesAfterProcessing()

# ============================================================
# Порядок синхронизации MT
# ============================================================
sync_order:
  - step: clearIdpColumnOnSheets
    description: "Очистка ID-P на всех листах"
  - step: _syncIdWithMain
    description: "Синхронизация ID между листами"
  - step: fillIdpOnSheetsByIdFromPrimary
    description: "Заполнение ID-P на всех листах"
  - step: copyPriceFromPrimaryToSheets
    description: "Копирование цены (с множителем для пробников)"
    params:
      multiplier: "from_parser_config"  # 1 или 10
  - step: recalculatePriceDynamicsFormulas
    description: "Формулы на Динамика цены"
  # Для пробников дополнительно:
  - step: updateStatusesAfterProcessing
    description: "Обновление статусов"
    condition: "samples_mode_only"

# ============================================================
# Features
# ============================================================
features:
  testers: true
  samples: true
  rrp: false              # НЕТ RRP в MT (исправлено)
  discounts: false
  group_id: true          # ID-G
  line_id: true           # ID-L
  abc_analysis: true
  tz_by_status: true
  order_verification: true

# ============================================================
# Business constants
# ============================================================
constants:
  not_found_text: "!!! НЕ НАЙДЕНО !!!"
  default_number_format: "#,##0.00"
  statuses:
    new: "New в работу"
    active: "Активный"
    inactive: "Неактивный"
    archive: "Архив"
  doc_types:
    - "353пп"
    - "ДС"
    - "СГР"
  tn_ved_codes:
    - "3304"  # Косметические средства для кожи
    - "3305"  # Средства для волос
    - "3307"  # Прочие парфюмерные средства
  spirits:
    max_group_size: 5

# ============================================================
# Google Drive folders
# ============================================================
drive:
  root_folder_id: "YOUR_MT_ROOT_FOLDER_ID"
  templates_folder_id: "YOUR_MT_TEMPLATES_FOLDER_ID"
  invoices_folder_id: "YOUR_MT_INVOICES_FOLDER_ID"
  documents_folder_id: "YOUR_MT_DOCUMENTS_FOLDER_ID"
  static_docs_ids:
    - "1uL8y5in7ARckjoP-4swt4Cb21wSESdcu"
    - "149u8lnDWSWGHig5GCN6kNLcPD7PW7lxJ"

# ============================================================
# Sync settings
# ============================================================
sync:
  lock_timeout_ms: 30000
  cache_expiration_seconds: 3600
  cache_key_prefix: "ECOSYSTEM_CACHE_V2.2_"
