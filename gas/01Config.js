/**–ø—Ä–∏–≤–µ—Ç
 * =======================================================================================
 * A_Config.gs ‚Äî –§–£–ù–î–ê–ú–ï–ù–¢ –°–ò–°–¢–ï–ú–´ (–ï–î–ò–ù–´–ô –§–ê–ô–õ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò)
 * ---------------------------------------------------------------------------------------
 * –í–ï–†–°–ò–Ø: 2.2 (–≠—Ç–∞–ª–æ–Ω–Ω–∞—è, –±–µ–∑ –º–æ–¥—É–ª—è FILE_PROCESSING)
 * –û–ü–ò–°–ê–ù–ò–ï:
 *   –≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî "–º–æ–∑–≥" –∏ "–ø—Ä–∏–±–æ—Ä–Ω–∞—è –ø–∞–Ω–µ–ª—å" –≤—Å–µ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ
 *   –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏–º–µ–Ω–∞, —Å–ø–∏—Å–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.
 *
 *   –ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü: –ö–æ–Ω—Ñ–∏–≥ —è–≤–ª—è–µ—Ç—Å—è "–ï–¥–∏–Ω—ã–º –ò—Å—Ç–æ—á–Ω–∏–∫–æ–º –ü—Ä–∞–≤–¥—ã" (Source of Truth).
 *   –°–∫—Ä–∏–ø—Ç—ã —á–∏—Ç–∞—é—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–±–ª–∏—Ü—ã. –ú—ã –º–µ–Ω—è–µ–º
 *   –∫–æ–Ω—Ñ–∏–≥, –∞ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–≤–æ–¥—è—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.
 * =======================================================================================
 */

(function (global) {
  // =======================================================================================
  // –ë–õ–û–ö 1: –û–ë–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´
  // =======================================================================================
  const SETTINGS = {
    /** –ü—Ä–æ–µ–∫—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ Apps Script –¥–ª—è —Ü–µ–ª–µ–π –æ—Ç–ª–∞–¥–∫–∏. */
    DEBUG_PROJECT_KEY: "SS",
    /** –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç –≤ –ª–æ–≥–∞—Ö –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö. */
    TIMEZONE: SpreadsheetApp.getActiveSpreadsheet()
      ? SpreadsheetApp.getActiveSpreadsheet().getSpreadsheetTimeZone()
      : "Europe/Moscow",
    /** –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤: DEBUG | INFO | WARN | ERROR | NONE */
    LOG_LEVEL: "DEBUG",
    LOG_LEVELS: { DEBUG: 0, INFO: 1, WARN: 2, ERROR: 3, NONE: 4 },
    get CURRENT_LOG_LEVEL() {
      const levelKey = (this.LOG_LEVEL || "ERROR").toUpperCase();
      const level = Object.prototype.hasOwnProperty.call(this.LOG_LEVELS, levelKey)
        ? this.LOG_LEVELS[levelKey]
        : 3;
      return level;
    },
    /** –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤. */
    LOCK_TIMEOUT_MS: 30000,
    /** –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –¥–ª—è –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö). 3600 = 1 —á–∞—Å. */
    CACHE_EXPIRATION_SECONDS: 3600,
    /** –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∫–ª—é—á–µ–π –≤ –∫—ç—à–µ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. */
    CACHE_KEY_PREFIX: "ECOSYSTEM_CACHE_V2.2_",
    /** –ò–º—è –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏-–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä onChange. */
    SYNC_HANDLER_FUNCTION: "handleOnChange",
    /** –ë–∞–∑–æ–≤—ã–µ –ª–∏—Å—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞. */
    BASE_SHEETS_FOR_CREATION: ["–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è", "–≠—Ç–∏–∫–µ—Ç–∫–∏", "–ó–∞–∫–∞–∑", "–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω—ã", "–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã", "ABC-–ê–Ω–∞–ª–∏–∑"],
  };

  // =======================================================================================
  // –ë–õ–û–ö 2: –†–ï–ï–°–¢–† –ò–ú–ï–ù –õ–ò–°–¢–û–í
  // =======================================================================================
  const SHEETS = {
    PRIMARY: "–ì–ª–∞–≤–Ω–∞—è",
    CERTIFICATION: "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
    LABELS: "–≠—Ç–∏–∫–µ—Ç–∫–∏",
    NEWS: "New sert",
    INVOICE_FULL: "–î–ª—è —Ç–∞–º–æ–∂–Ω–∏",
    ORDER: "–û—Ä–¥–µ—Ä", // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö (–∫–Ω–æ–ø–∫–∏ –û–±—Ä–∞–±–æ—Ç–∫–∞/–ó–∞–≥—Ä—É–∑–∏—Ç—å)
    ORDER_FORM: "–ó–∞–∫–∞–∑",
    PRICE: "–ü—Ä–∞–π—Å",
    STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏", // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö (–∫–Ω–æ–ø–∫–∏ –û–±—Ä–∞–±–æ—Ç–∫–∞/–ó–∞–≥—Ä—É–∑–∏—Ç—å)
    PRICE_DYNAMICS: "–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω—ã",
    PRICE_CALCULATION: "–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã",
    ABC_ANALYSIS: "ABC-–ê–Ω–∞–ª–∏–∑",
    TZ_BY_STATUS: "–¢–ó –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º",
    ORDER_VERIFICATION: "–°–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞",
    FOR_DATABASE: "–î–ª—è –±–∞–∑—ã",
    LOCAL_LOOKUP: "–í–∏–¥ –∏ –∫–æ–¥",
    RULES: "–ü—Ä–∞–≤–∏–ª–∞ —Å–∏–Ω—Ö—Ä–æ",
    LOG: "–ñ—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ",
    LOG_DEBUG: "–ñ—É—Ä–Ω–∞–ª –ª–æ–≥–æ–≤",
    EXTERNAL_DOCS: "–í–Ω–µ—à–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
  };

  // =======================================================================================
  // –ë–õ–û–ö 3: –°–¢–†–£–ö–¢–£–†–ê –¢–ê–ë–õ–ò–¶ ("–ò–°–¢–û–ß–ù–ò–ö –ü–†–ê–í–î–´")
  // =======================================================================================
  // –í–ù–ò–ú–ê–ù–ò–ï: HEADERS –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ SET –∏–º–µ–Ω.
  // –ü–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–∏—Å—Ç–∞—Ö –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ HEADERS –∑–∞–ø—Ä–µ—â–µ–Ω–∞.
  const HEADERS = {};
  HEADERS[SHEETS.PRIMARY] = [
    "ID",
    "ID-P",
    "–°—Ç–∞—Ç—É—Å",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ/–∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ö–æ–¥ –≤ 1–°",
    "–ù–∞–∑–≤–∞–Ω–∏–µ  ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–û–±—ä—ë–º",
    "–§–æ—Ä–º–∞ –≤—ã–ø—É—Å–∫–∞",
    "—à—Ç./—É–ø.",
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞",
    "–õ–∏–Ω–∏—è",
    "–ì—Ä—É–ø–ø–∞",
    "BAR CODE",
    "ID-G",
    "ID-L",
  ];
  HEADERS[SHEETS.CERTIFICATION] = [
    "ID",
    "–°—Ç–∞—Ç—É—Å",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –î–°",
    "–û–±—ä—ë–º",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–∞",
    "–û–±—ä—ë–º –∞–Ω–≥–ª.",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–∞ –ê–Ω–≥–ª",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ/–∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ö–æ–¥ –≤ 1–°",
    "BAR CODE",
    "–∫–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
    "–∫–∞—Ç–µ–≥–æ—Ä–∏—è",
    "–í–∏–¥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
    "–ö–æ–¥ –¢–ù –í–≠–î",
    "–î–°",
    "–î–° –¥–æ",
    "–Ω–æ–º–µ—Ä –î–°",
    "–ü—Ä–æ—Ç–æ–∫–æ–ª –î–°",
    "–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–æ–ø",
    "–°–∫–∞–Ω —Å–ø–∏—Ä—Ç",
    "–°–ø–∏—Ä—Ç –î–æ",
    "INCI",
    "COA",
    "–≠—Ç–∏–∫–µ—Ç–∫–∞",
  ];
  HEADERS[SHEETS.LABELS] = [
    "ID",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞",
    "–û–±—ä—ë–º",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
    "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
    "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
    "–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±–µ–∑ %",
    "–æ–ø–∏—Å–∞–Ω–∏–µ –ë–£–ö–õ–ï–¢",
    "–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ë–£–ö–õ–ï–¢",
    "—Å–æ—Å—Ç–∞–≤ –ë–£–ö–õ–ï–¢",
    "–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤",
  ];
  HEADERS[SHEETS.NEWS] = [
    "ID",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –î–°",
    "–û–±—ä—ë–º",
    "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥—Å",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ/–∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞",
    "–ö–æ–¥ –¢–ù –í–≠–î",
    "–í–∏–¥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
    "INCI",
    "COA",
    "–≠—Ç–∏–∫–µ—Ç–∫–∞",
    "–í–∏–¥ –¥–æ–∫—É–º–µ–Ω—Ç–∞",
    "–ü—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø.",
    "–¥–æ–ø –ø—Ä–æ—Ç–æ–∫–æ–ª/–î–∞—Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª",
    "–ì–¢–î/‚Ññ –∏–Ω–≤–æ–π—Å",
    "‚Ññ–≥—Ç–¥/–¥–∞—Ç–∞ –∏–Ω–≤–æ–π—Å–∞",
    "–î–æ–≥–æ–≤–æ—Ä (–£–õ)",
    "–ó–∞—è–≤–∫–∞ –î–°",
    "–ú–∞–∫–µ—Ç",
    "–°–∫–∞–Ω –î–°",
    "–î–° –¥–æ",
    "–Ω–æ–º–µ—Ä –î–°",
    "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ",
    "pH",
    "–ù–æ—Ä–º–∞ pH",
  ];
  HEADERS[SHEETS.INVOICE_FULL] = [
    "ID",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ê–Ω–≥–ª",
    "–∫–æ–ª-–≤–æ",
    "–¶–µ–Ω–∞ –µ–¥.",
    "–°—É–º–º–∞",
    "–î–°",
    "–î–° –¥–æ",
    "–Ω–æ–º–µ—Ä –î–°",
    "–°–ø–∏—Ä—Ç",
    "–°–ø–∏—Ä—Ç –¥–æ",
    "—Å—Ç–∞—Ç—É—Å",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
    "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
    "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
    "–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±–µ–∑ %",
  ];
  HEADERS[SHEETS.ORDER] = [
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ù–∞–∑–≤–∞–Ω–∏–µ ENG",
    "–ö–æ–ª-–≤–æ –ø–æ—Å—Ç–∞–≤–∫–∞",
    "–¶–µ–Ω–∞ –µ–¥.",
    "–°–∫–∏–¥–∫–∞, %",
    "–ò—Ç–æ–≥–æ —Ü–µ–Ω–∞",
    "–ì–æ–¥–µ–Ω –¥–æ",
  ];
  HEADERS[SHEETS.ORDER_FORM] = [
    "ID",
    "ID-P",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ù–∞–∑–≤–∞–Ω–∏–µ  ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–û–±—ä—ë–º",
    "—à—Ç./—É–ø.",
    "–ü–†–û–î–ê–ñ–ò",
    "–û—Å—Ç–∞—Ç–æ–∫",
    "—Ç–æ–≤–∞—Ä –≤  –ü–£–¢–ò",
    "–û—Å—Ç–∞—Ç–æ–∫ 1",
    "–°–ì 1",
    "–û—Å—Ç–∞—Ç–æ–∫ 2",
    "–°–ì 2",
    "–û—Å—Ç–∞—Ç–æ–∫3",
    "–°–ì 3",
    "–°–ü–ò–°–ê–ù–û",
    "–†–ï–ó–ï–†–í",
    "–°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏, —à—Ç",
    "–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤, —à—Ç",
    "–ù–∞ —Å–∫–æ–ª—å–∫–æ –º–µ—Å –∑–∞–ø–∞—Å",
    "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–∫–∞–∑–∞—Ç—å, —à—Ç",
    "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–∫–∞–∑",
    "–∑–∞–∫–∞–∑ –≤ —É–ø–∞–∫–æ–≤–∫–∞—Ö",
    "–ó–ê–ö–ê–ó",
    "EXW  ALFASPA  —Ç–µ–∫—É—â–∞—è, ‚Ç¨",
    "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ 0,00 ‚Ç¨",
    "–ê–ö–¶–ò–ò",
    "—É—Å–ª–æ–≤–∏–µ#",
    "–∫–æ–º–µ–Ω—Ç–∞—Ä–∏–π#",
    "–°—Ä–æ–∫#",
    "–ù–∞–±–æ—Ä",
    "—É—Å–ª–æ–≤–∏–µ",
    "–∫–æ–º–µ–Ω—Ç–∞—Ä–∏–π",
    "–°—Ä–æ–∫",
    "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–∞–π—Å",
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞",
    "–ì—Ä—É–ø–ø–∞ –ª–∏–Ω–∏–∏",
    "–õ–∏–Ω–∏—è –ü—Ä–∞–π—Å",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
    "–ü—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å",
  ];
  HEADERS[SHEETS.PRICE] = [
    "ID",
    "ID-L",
    "–°—Ç–∞—Ç—É—Å",
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ê—Ä—Ç. –†—É—Å",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
    "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
    "–û–±—ä—ë–º",
    "–î–ª—è",
    "–ö–∞—Ä—Ç–∏–Ω–∫–∞",
    "–ö–∞—Ä—Ç–∏–Ω–∫–∞ 2",
    "–¶–µ–Ω–∞",
    "RRP",
    "–ï-comerc",
    "–ì—Ä—É–ø–ø–∞ –ª–∏–Ω–∏–∏",
    "–õ–∏–Ω–∏—è –ü—Ä–∞–π—Å",
    "–ü—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å",
    "–õ–∏–Ω–∏—è –†—É—Å",
  ];
  HEADERS[SHEETS.STOCKS] = [
    "–ö–æ–¥ —Ç–æ–≤–∞—Ä–∞",
    "–í—ã–±—Ä–∞–Ω–Ω–∞—è –ø–æ–¥–≥—Ä—É–ø–ø–∞",
    "–ê—Ä—Ç–∏–∫—É–ª",
    "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
    "–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥",
    "–°–ø–∏—Å–∞–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥",
    "–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å",
    "–ò–∑ –Ω–∏—Ö –≤ —Ä–µ–∑–µ—Ä–≤–µ",
    "–í—Å–µ–≥–æ",
    "–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏",
    "–¶–µ–Ω–∞",
  ];
  HEADERS[SHEETS.LOCAL_LOOKUP] = ["–ö–æ–¥", "–í–∏–¥"]; /// –ù–ê–î–û –°–î–ï–õ–ê–¢–¨ –°–ü–†–ê–í–û–ß–ù–ò–ö
  HEADERS[SHEETS.PRICE_DYNAMICS] = [
    "ID",
    "ID-P",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ö–æ–¥ –≤ 1–°",
    "–ù–∞–∑–≤–∞–Ω–∏–µ  ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–û–±—ä—ë–º",
    "–¶–ï–ù–ê EXW –∏–∑ –ë/–ó",
    "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
    "EXW 2025, ‚Ç¨",
    "–°–ö–ò–î–ö–ê –û–¢ EXW 2025, %",
    "EXW ALFASPA 2025, ‚Ç¨",
    "–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ 2025, ‚ÇΩ",
    "DDP-–ú–û–°–ö–í–ê 2025, ‚ÇΩ",
    "–ü—Ä–∏—Ä–æ—Å—Ç EXW, ‚Ç¨",
    "–ü—Ä–∏—Ä–æ—Å—Ç DDP-–ú–û–°–ö–í–ê, ‚ÇΩ",
  ];
  HEADERS[SHEETS.PRICE_CALCULATION] = [
    "ID",
    "ID-P",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ö–æ–¥ –≤ 1–°",
    "–ù–∞–∑–≤–∞–Ω–∏–µ  ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
    "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
    "–û–±—ä—ë–º",
    "–¶–ï–ù–ê EXW –∏–∑ –ë/–ó",
    "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
    "EXW  –ø—Ä–µ–¥—ã–¥—É—â–∞—è, ‚Ç¨",
    "EXW  —Ç–µ–∫—É—â–∞—è, ‚Ç¨",
    "EXW  ALFASPA  —Ç–µ–∫—É—â–∞—è, ‚Ç¨",
    "–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞, ‚ÇΩ",
    "DDP  -–ú–û–°–ö–í–ê,  ‚ÇΩ",
  ];
  HEADERS[SHEETS.ABC_ANALYSIS] = [
    "ID",
    "ID-P",
    "–°—Ç–∞—Ç—É—Å",
    "–ê—Ä—Ç. –†—É—Å",
    "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
    "–ö–æ–¥ –±–∞–∑–∞",
    "–ö–æ–¥ –≤ 1–°",
    "–ù–∞–∑–≤–∞–Ω–∏–µ  ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
  ];
  HEADERS[SHEETS.TZ_BY_STATUS] = []; // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –º–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  HEADERS[SHEETS.ORDER_VERIFICATION] = []; // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –º–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  HEADERS[SHEETS.FOR_DATABASE] = []; // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –º–µ—Ä–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  HEADERS[SHEETS.RULES] = [];
  HEADERS[SHEETS.LOG] = [];
  HEADERS[SHEETS.EXTERNAL_DOCS] = [];
  // =======================================================================================
  // –ë–õ–û–ö 3.1: –ú–ê–ü–ü–ò–ù–ì –õ–û–ì–ò–ß–ï–°–ö–ò–• –ö–û–õ–û–ù–û–ö ‚Üí –¢–ï–ö–°–¢–´ –ó–ê–ì–û–õ–û–í–ö–û–í
  // –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
  // =======================================================================================
  const COLUMNS = {
    INVOICE_FULL: {
      ID: "ID",
      RUS_ART: "–ê—Ä—Ç. –†—É—Å",
      PRODUCER_ART: "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
      PRODUCT_NAME: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
      PRODUCT_NAME_EN: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ê–Ω–≥–ª",
      QTY: "–∫–æ–ª-–≤–æ",
      PRICE: "–¶–µ–Ω–∞ –µ–¥.",
      TOTAL: "–°—É–º–º–∞",
      DS_LINK: "–î–°",
      DS_UNTIL: "–î–° –¥–æ",
      DS_NUMBER: "–Ω–æ–º–µ—Ä –î–°",
      SPIRIT_LINK: "–°–ø–∏—Ä—Ç",
      SPIRIT_UNTIL: "–°–ø–∏—Ä—Ç –¥–æ",
      STATUS: "—Å—Ç–∞—Ç—É—Å",
      NOTE: "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
      PURPOSE: "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
      APPLICATION: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
      ACTIVE_INGREDIENTS_NO_PERCENT: "–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±–µ–∑ %",
    },
    CERTIFICATION: {
      ID: "ID",
      STATUS: "–°—Ç–∞—Ç—É—Å",
      RUS_NAME_BY_DS: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
      ENG_NAME_BY_DS: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
      DS_NAME: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –î–°",
      INVOICE_NAME: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–∞",
      INVOICE_NAME_EN: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–Ω–≤–æ–π—Å–∞ –ê–Ω–≥–ª",
      RUS_ART: "–ê—Ä—Ç. –†—É—Å",
      PRODUCER_ART: "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
      DS_SCAN: "–î–°",
      DS_UNTIL: "–î–° –¥–æ",
      DS_NUMBER: "–Ω–æ–º–µ—Ä –î–°",
      SPIRIT_SCAN: "–°–∫–∞–Ω —Å–ø–∏—Ä—Ç",
      SPIRIT_UNTIL: "–°–ø–∏—Ä—Ç –î–æ",
    },
    LABELS: {
      RUS_ART: "–ê—Ä—Ç. –†—É—Å",
      PURPOSE: "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
      APPLICATION: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≠—Ç–∏–∫–µ—Ç–∫–∞",
      ACTIVE_INGREDIENTS_NO_PERCENT: "–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±–µ–∑ %",
    },
  };
  // =======================================================================================
  // –ë–õ–û–ö 3.5: –û–ë–©–ò–ï –ö–û–ù–°–¢–ê–ù–¢–´ –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ò
  // =======================================================================================
  const VALUES = {
    NOT_FOUND_TEXT: "!!! –ù–ï –ù–ê–ô–î–ï–ù–û !!!",
    DEFAULT_NUMBER_FORMAT: "#,##0.00",
    STATUSES: { NEW: "New –≤ —Ä–∞–±–æ—Ç—É" },
    DOC_TYPES: { DS_OPTIONS: ["353–ø–ø", "–î–°", "–°–ì–†"] },
    PROTOCOLS_353PP_FILTER: "353–ø–ø",
    SPIRITS: { MAX_GROUP_SIZE: 5 },
    STATIC_DOCS_IDS: [
      "1uL8y5in7ARckjoP-4swt4Cb21wSESdcu",
      "149u8lnDWSWGHig5GCN6kNLcPD7PW7lxJ",
    ],
    MONTH_NAMES: [
      "—è–Ω–≤–∞—Ä—å",
      "—Ñ–µ–≤—Ä–∞–ª—å",
      "–º–∞—Ä—Ç",
      "–∞–ø—Ä–µ–ª—å",
      "–º–∞–π",
      "–∏—é–Ω—å",
      "–∏—é–ª—å",
      "–∞–≤–≥—É—Å—Ç",
      "—Å–µ–Ω—Ç—è–±—Ä—å",
      "–æ–∫—Ç—è–±—Ä—å",
      "–Ω–æ—è–±—Ä—å",
      "–¥–µ–∫–∞–±—Ä—å",
    ],
  };

  // =======================================================================================
  // –ë–õ–û–ö 3.6: –†–ï–ï–°–¢–† –ú–ï–ù–Æ
  // ---------------------------------------------------------------------------------------
  // –í–ê–ñ–ù–û: –í—Å–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (01Config.js).
  // –ü–æ—Ä—è–¥–æ–∫ –≥—Ä—É–ø–ø –º–µ–Ω—é (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ):
  //   1. üßæ –ó–∞–∫–∞–∑ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
  //   2. üìä –°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑ (–≤–∫–ª—é—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å—Ç–∞–¥–∏–∏ –∑–∞–∫–∞–∑–∞)
  //   3. üì¶ –í—ã–≥—Ä—É–∑–∫–∞
  //   4. üöö –ü–æ—Å—Ç–∞–≤–∫–∞
  //   5. üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  //   6. ‚öôÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
  // =======================================================================================
  const MENU_REGISTRY_BLUEPRINT = [
    // –ì—Ä—É–ø–ø–∞ "üßæ –ó–∞–∫–∞–∑" —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ PRIMARY_DATA_MENU_ACTIONS
    // –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π —á–µ—Ä–µ–∑ _buildPrimaryDataMenuGroup()

    {
      title: "üì¶ –í—ã–≥—Ä—É–∑–∫–∞",
      items: [
        { label: "–í—ã–≥—Ä—É–∑–∏—Ç—å –ê–∫—Ü–∏–∏", fn: "exportPromotions" },
        { label: "–í—ã–≥—Ä—É–∑–∏—Ç—å –ù–∞–±–æ—Ä—ã", fn: "exportSets" },
      ],
    },
    {
      title: "üöö –ü–æ—Å—Ç–∞–≤–∫–∞",
      items: [
        { label: "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç '–û—Ä–¥–µ—Ä'", fn: "formatOrderSheet" },
        { separator: true },
        { label: "1. –°–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç '–î–ª—è –∏–Ω–≤–æ–π—Å–∞'", fn: "createFullInvoice" },
        { label: "2. –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã", fn: "collectAndCopyDocuments" },
      ],
    },
    {
      title: "üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
      items: [
        { label: "–õ–∏—Å—Ç –Ω–æ–≤–∏–Ω–∫–∏", fn: "createNewsSheetFromCertification" },
        { separator: true },
        {
          label: "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (353–ø–ø)",
          fn: "generateProtocols_353pp",
        },
        { label: "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –î–° (353–ø–ø)", fn: "generateDsLayouts_353pp" },
        {
          label: "–°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞—è–≤–∫–∏ (353–ø–ø)",
          fn: "structureDocuments_353pp",
        },
        { separator: true },
        { label: "–ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Ä—Ç—ã", fn: "calculateAndAssignSpiritNumbers" },
        { label: "–°–æ–∑–¥–∞—Ç—å –ú–∞–∫–µ—Ç—ã —Å–ø–∏—Ä—Ç—ã", fn: "generateSpiritProtocols" },
        { separator: true },
        {
          label: "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∫–∞—Å–∫–∞–¥—ã (–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)",
          fn: "runManualCascadeOnCertification",
        },
      ],
    },
    {
      title: "‚öôÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è",
      items: [
        { label: "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞", fn: "showSyncConfigDialog" },
        { label: "üßπ –û—á–∏—Å—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", fn: "clearAllToasts" },
        { label: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏", fn: "showExternalDocManagerDialog" },
        { separator: true },
        {
          submenu: "–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏",
          items: [
            { label: "–î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ç–∏–∫—É–ª", fn: "addArticleManually" },
            {
              label: "–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π)",
              fn: "deleteSelectedRowsWithSync",
            },
            { separator: true },
            {
              label: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –î–ê–ù–ù–´–ï –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏",
              fn: "syncSelectedRow",
            },
            {
              label: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –í–°–Æ —Ç–∞–±–ª–∏—Ü—É",
              fn: "runFullSync",
            },
          ],
        },
        { separator: true },
        { label: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã", fn: "setupTriggers" },
        { separator: true },
        {
          submenu: "üìã –ñ—É—Ä–Ω–∞–ª",
          items: [
            { separator: true },
            {
              label: "–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∂—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ",
              fn: "recreateLogSheet",
            },
            {
              label: "–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∂—É—Ä–Ω–∞–ª –ª–æ–≥–æ–≤",
              fn: "recreateDebugLogSheet",
            },
            {
              label: "–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª (–±—ã—Å—Ç—Ä–æ)",
              fn: "quickCleanLogSheet",
            },
          ],
        },
      ],
    },
    {
      title: "ü§ñ –ê–≥–µ–Ω—Ç",
      items: [
        { label: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å", fn: "menuCheckService" },
        { label: "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gemini", fn: "setupGeminiComplete" },
        { label: "üìã –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", fn: "showGeminiSettings" },
        { separator: true },
        { label: "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É", fn: "menuAnalyzeSelected" },
        { label: "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏", fn: "menuAnalyzeEmpty" },
        { separator: true },
        { label: "–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", fn: "menuShowCategories" },
      ],
    },
  ];

  const PRIMARY_DATA_MENU_ORDER = ["MAIN", "TESTER", "SAMPLES", "PROBES", "STOCKS", "NEW_PRICE_YEAR"];
  const ORDER_STAGES_MENU_ORDER = ["SORT_MANUFACTURER", "SORT_PRICE", "STAGE_ALL", "STAGE_ORDER", "STAGE_PROMOTIONS", "STAGE_SET", "STAGE_PRICE"];

  const PRIMARY_DATA_MENU_ACTIONS = {
    MAIN: { fnByProject: { SK: "processSkPriceSheet", SS: "processSsPriceSheet", MT: "processMtMainPrice" } },
    TESTER: { fnByProject: { MT: "processMtTesterPrice" } },
    SAMPLES: { fnByProject: { MT: "processMtSamplesPrice" } },
    PROBES: { fnByProject: { SK: "processSkPriceProbes" } },
    STOCKS: { fnByProject: { SK: "loadSkStockData", SS: "loadSsStockData", MT: "loadMtStockData" } },
    NEW_PRICE_YEAR: { fn: "addNewYearColumnsToPriceDynamics" },
    SORT_MANUFACTURER: { fnByProject: { SK: "sortSkOrderByManufacturer", SS: "sortSsOrderByManufacturer", MT: "sortMtOrderByManufacturer" } },
    SORT_PRICE: { fnByProject: { SK: "sortSkOrderByPrice", SS: "sortSsOrderByPrice", MT: "sortMtOrderByPrice" } },
    STAGE_ALL: { fn: "showAllOrderData" },
    STAGE_ORDER: { fn: "showOrderStage" },
    STAGE_PROMOTIONS: { fn: "showPromotionsStage" },
    STAGE_SET: { fn: "showSetStage" },
    STAGE_PRICE: { fn: "showPriceStage" },
  };

  // =======================================================================================
  // –ë–õ–û–ö 3.8: –û–ë–©–ò–ï –ü–ê–¢–¢–ï–†–ù–´ –ò–ú–Å–ù –§–ê–ô–õ–û–í/–ü–ê–ü–û–ö –í DRIVE
  // =======================================================================================
  const DRIVE_STRUCTURE_PATTERNS = {
    PROTOCOLS_353PP: {
      FOLDER_NAME_SUFFIX: "353–ø–ø",
      DOCS_SUBFOLDER_NAME: "–ú–∞–∫–µ—Ç—ã",
      PDFS_SUBFOLDER_NAME: "–ü—Ä–æ—Ç–æ–∫–æ–ª—ã",
    },
    DS_LAYOUTS: { TARGET_SUBFOLDER_NAME: "–ó–∞—è–≤–∫–∞" },
    DOC_STRUCTURING: { ROOT_FOLDER_NAME: "–∑–∞—è–≤–∫–∞ 353–ø–ø" },
    INVOICE_DESCRIPTION: { FILE_NAME_SUFFIX: "–æ–ø–∏—Å–∞–Ω–∏–µ" },
  };

  // =======================================================================================
  // –ë–õ–û–ö 3.9: –ü–†–ê–í–ò–õ–ê –ö–ê–°–ö–ê–î–ù–´–• –û–ë–ù–û–í–õ–ï–ù–ò–ô
  // =======================================================================================
  const CASCADE_RULES = {
    CERTIFICATION: {
      SOURCE_HEADERS: [
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—É—Å –ø–æ –î–°",
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∞–Ω–≥–ª –ø–æ –î–°",
        "–û–±—ä—ë–º",
        "–ö–æ–¥ –¢–ù –í–≠–î",
      ],
      VOLUME_EN_REPLACEMENTS: [
        { from: "–º–ª", to: "ml" },
        { from: "–≥—Ä", to: "g" },
        { from: "–¢–µ—Å—Ç–µ—Ä", to: "Tester" },
        { from: "—à—Ç. —Ö", to: "*" },
      ],
    },
  };

  // =======================================================================================
  // –ë–õ–û–ö 4: –£–ù–ò–ö–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –ü–†–û–ï–ö–¢–û–í (–ë–†–ï–ù–î–û–í)
  // =======================================================================================
  const PROJECTS = {
    // ============================ –ü–†–û–ï–ö–¢ "SS" ============================
    SS: {
      /** –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤, –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞. */
      PREFIX: "SS-",
      /** –ù–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Google Drive –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ SS. */
      DRIVE: {
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Ä—Ç—ã / –°–æ–∑–¥–∞—Ç—å –ú–∞–∫–µ—Ç—ã —Å–ø–∏—Ä—Ç—ã */
        SPIRITS: {
          /** üìÅ –ü–∞–ø–∫–∞-—Ä–æ–¥–∏—Ç–µ–ª—å, –∫—É–¥–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø–∞–ø–∫–∏ —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ —Å–ø–∏—Ä—Ç–æ–≤. */
          PARENT_FOLDER_ID: "1TOcKN8DxZr1a3Vr5jwWGwUxU0D83pldI",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Å–ø–∏—Ä—Ç–æ–≤. */
          TEMPLATE_DOC_ID: "1cOSsXdgEkkB9bSvb_S9h0w6IPwrZuufyPV97DVaepDM",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (353–ø–ø) / –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (353–ø–ø) */
        PROTOCOLS_353PP: {
          /** üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∑–∞—è–≤–æ–∫ 353–ø–ø. */
          PARENT_FOLDER_ID: "1xajuDu91Epgh5iz8tG1F0xvoTAkgE7Du",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ 353–ø–ø. */
          TEMPLATE_DOC_ID: "1O7TRu7iF47KWNmAaqtcvCEfpKHa7IswWLFPcvFTnlqc",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –î–° (353–ø–ø) */
        DS_LAYOUTS: {
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–∫–µ—Ç–æ–≤ –ó–∞—è–≤–∫–∏ –î–°. */
          TEMPLATE_DOC_ID: "1CTP6fLTZEmQf-PYHUio417MsFg_0-tLAUvNh845enXQ",
        },
        /** üìÑ –ò–Ω–≤–æ–π—Å—ã ‚Üí –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã */
        INVOICES: {
          /** üóÇÔ∏è –ü–∞–ø–∫–∞-—Å–±–æ—Ä–Ω–∏–∫, –∫—É–¥–∞ –±—É–¥—É—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º. */
          COLLECTION_PARENT_FOLDER_ID: "1DjrtDKLUMCypFqlC38kjgOESupTjjUpK",
        },
      },
      /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ SS. */
      VALUES: { LABORATORY_NAME: "COSMETIC RESEARCH GROUP" },
      /** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞–º–∏ –∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ SS. */
      PRIMARY_DATA: {
        SOURCE: {
          DOC_ID: "1J8Yzfz9621gqJkPh5ZKBa0v34nv3v9_7OL4JIROlHj0",
        },
        SHEETS: {
          SOURCE: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
          TARGET: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
        },
        OUTPUT_HEADERS: [
          "ID-P",
          "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
          "–ù–∞–∑–≤–∞–Ω–∏–µ ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
          "–û–±—ä—ë–º",
          "–§–æ—Ä–º–∞ –≤—ã–ø—É—Å–∫–∞",
          "BAR CODE",
          "—à—Ç./—É–ø.",
          "–¶–µ–Ω–∞",
          "–ì—Ä—É–ø–ø–∞",
        ],
        MENU: {
          TITLE: "üßæ –ó–∞–∫–∞–∑",
          ITEMS: {
            MAIN: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            STOCKS: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏",
            NEW_PRICE_YEAR: "New –≥–æ–¥ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∞",
          },
        },
        ORDER_STAGES_MENU: {
          TITLE: "üìä –°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑",
          ITEMS: {
            SORT_MANUFACTURER: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é",
            SORT_PRICE: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–∞–π—Å—É",
            STAGE_ALL: "1. –í—Å–µ –¥–∞–Ω–Ω—ã–µ",
            STAGE_ORDER: "2. –ó–∞–∫–∞–∑",
            STAGE_PROMOTIONS: "3. –ê–∫—Ü–∏–∏",
            STAGE_SET: "4. –ù–∞–±–æ—Ä",
            STAGE_PRICE: "5. –ü—Ä–∞–π—Å",
          },
        },
      },
      /** "–¢–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è" –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ SS. */
      OVERRIDES: {},
    },

    // ============================ –ü–†–û–ï–ö–¢ "SK" ============================
    SK: {
      /** –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤, –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞. */
      PREFIX: "SK-",
      /** –ù–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Google Drive –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ SK. */
      DRIVE: {
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Ä—Ç—ã / –°–æ–∑–¥–∞—Ç—å –ú–∞–∫–µ—Ç—ã —Å–ø–∏—Ä—Ç—ã */
        SPIRITS: {
          /** üìÅ –ü–∞–ø–∫–∞-—Ä–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å–ø–∏—Ä—Ç–æ–≤. */
          PARENT_FOLDER_ID: "1NSJpEkTlEJ7JGJwK4UmDpefsCFAyuWOu",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å–ø–∏—Ä—Ç–æ–≤. */
          TEMPLATE_DOC_ID: "11ZCgJqovASwhMgQXX1PwkYyIcGFIJ-5UAmA3LOqYbhY",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (353–ø–ø) / –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (353–ø–ø) */
        PROTOCOLS_353PP: {
          /** üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∑–∞—è–≤–æ–∫ 353–ø–ø. */
          PARENT_FOLDER_ID: "1xajuDu91Epgh5iz8tG1F0xvoTAkgE7Du",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ 353–ø–ø. */
          TEMPLATE_DOC_ID: "159qAGqM_E6uY0vVE_HMbg8ByIv6zeK4kFCxaeLeUqeI",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –î–° (353–ø–ø) */
        DS_LAYOUTS: {
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –º–∞–∫–µ—Ç–æ–≤ –ó–∞—è–≤–∫–∏ –î–°. */
          TEMPLATE_DOC_ID: "1ugPWwjsMqt2DtUBJziafxRAxsYHtLJRhdDMs8ZVaf7U",
        },
        /** üìÑ –ò–Ω–≤–æ–π—Å—ã ‚Üí –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã */
        INVOICES: {
          /** üóÇÔ∏è –ü–∞–ø–∫–∞-—Å–±–æ—Ä–Ω–∏–∫ –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤. */
          COLLECTION_PARENT_FOLDER_ID: "1DjrtDKLUMCypFqlC38kjgOESupTjjUpK",
        },
      },
      /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ SK. */
      VALUES: { LABORATORY_NAME: "CARMADO S.L." },
      PRIMARY_DATA: {
        SOURCE: {
          DOC_ID: "1zSu0PzKKa5wvwMZCicwLN8N7Rwhs8XlJVrTrt2LMzQs",
        },
        SHEETS: {
          SOURCE: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            PROBES: "-–ø—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
          TARGET: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            PROBES: "-–ø—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
        },
        OUTPUT_HEADERS: [
          "ID-P",
          "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
          "–ù–∞–∑–≤–∞–Ω–∏–µ ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
          "–õ–∏–Ω–∏—è",
          "–∫–æ–ª-–≤–æ",
          "—à—Ç./—É–ø.",
          "—Ü–µ–Ω–∞",
          "–≤—Å–µ–≥–æ",
          "RRP",
          "–ì—Ä—É–ø–ø–∞",
        ],
        GROUP_HEADER_COLOR: "#5b0058",
        PROBES_IDL_HEADER: "ID-G",
        MENU: {
          TITLE: "üßæ –ó–∞–∫–∞–∑",
          ITEMS: {
            MAIN: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            PROBES: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏",
            NEW_PRICE_YEAR: "New –≥–æ–¥ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∞",
          },
        },
        ORDER_STAGES_MENU: {
          TITLE: "üìä –°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑",
          ITEMS: {
            SORT_MANUFACTURER: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é",
            SORT_PRICE: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–∞–π—Å—É",
            STAGE_ALL: "1. –í—Å–µ –¥–∞–Ω–Ω—ã–µ",
            STAGE_ORDER: "2. –ó–∞–∫–∞–∑",
            STAGE_PROMOTIONS: "3. –ê–∫—Ü–∏–∏",
            STAGE_SET: "4. –ù–∞–±–æ—Ä",
            STAGE_PRICE: "5. –ü—Ä–∞–π—Å",
          },
        },
      },
      /** "–¢–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è" –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ SK. */
      OVERRIDES: {},
    },

    // ============================ –ü–†–û–ï–ö–¢ "MT" ============================
    MT: {
      /** –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤, –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞. */
      PREFIX: "MT-",
      /** –ù–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Google Drive –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ MT. */
      DRIVE: {
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Ä—Ç—ã / –°–æ–∑–¥–∞—Ç—å –ú–∞–∫–µ—Ç—ã —Å–ø–∏—Ä—Ç—ã */
        SPIRITS: {
          /** üìÅ –ü–∞–ø–∫–∞-—Ä–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å–ø–∏—Ä—Ç–æ–≤. */
          PARENT_FOLDER_ID: "1fsJeFfAgWPADM8Vf4oiKfKQDZAMvQDBP",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å–ø–∏—Ä—Ç–æ–≤. */
          TEMPLATE_DOC_ID: "1nP8gndWnssr1EUXUwYWCajtW70p0wKx-s4Qkwe8Ml_8",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (353–ø–ø) / –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (353–ø–ø) */
        PROTOCOLS_353PP: {
          /** üìÅ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∑–∞—è–≤–æ–∫ 353–ø–ø. */
          PARENT_FOLDER_ID: "1xajuDu91Epgh5iz8tG1F0xvoTAkgE7Du",
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ 353–ø–ø. */
          TEMPLATE_DOC_ID: "1trf--Ump09D1IXhUz-c6xr5nJwepN3Q_5l2Cbl6e_78",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –î–° (353–ø–ø) */
        DS_LAYOUTS: {
          /** üìù –®–∞–±–ª–æ–Ω Google Doc –¥–ª—è –º–∞–∫–µ—Ç–æ–≤ –ó–∞—è–≤–∫–∏ –î–°. */
          TEMPLATE_DOC_ID: "1mfHSLdNeBF8jl54G1Gf-9k2nsQKL-7MKokdPAbtmL0c",
        },
        /** üìÑ –ò–Ω–≤–æ–π—Å—ã ‚Üí –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã */
        INVOICES: {
          /** üóÇÔ∏è –ü–∞–ø–∫–∞-—Å–±–æ—Ä–Ω–∏–∫ –ø–æ –º–µ—Å—è—Ü–∞–º –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤. */
          COLLECTION_PARENT_FOLDER_ID: "1DjrtDKLUMCypFqlC38kjgOESupTjjUpK",
        },
      },
      /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ MT. */
      VALUES: { LABORATORY_NAME: "COSMETICA COSBAR S.L." },
      /** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞–º–∏ –∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ MT. */
      PRIMARY_DATA: {
        SOURCE: {
          DOC_ID: "1BW8Gk5_X2EZVjbnaa2yDm-bPzzlggwQrHepeNCcPCc0",
        },
        SHEETS: {
          SOURCE: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            TESTER: "-–¢–µ—Å—Ç–µ—Ä",
            SAMPLES: "-–ü—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
          TARGET: {
            MAIN: "-–ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            TESTER: "-–¢–µ—Å—Ç–µ—Ä",
            SAMPLES: "-–ü—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "-–æ—Å—Ç–∞—Ç–∫–∏",
          },
        },
        OUTPUT_HEADERS: [
          "ID-P",
          "–ê—Ä—Ç. –ø—Ä–æ–∏–∑–≤.",
          "–ù–∞–∑–≤–∞–Ω–∏–µ ENG –ø—Ä–∞–π—Å –ø—Ä–æ–∏–∑–≤",
          "–û–±—ä—ë–º",
          "BAR CODE",
          "—à—Ç./—É–ø.",
          "–¶–µ–Ω–∞",
          "–ì—Ä—É–ø–ø–∞",
        ],
        MENU: {
          TITLE: "üßæ –ó–∞–∫–∞–∑",
          ITEMS: {
            MAIN: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ë/–ó –ø–æ—Å—Ç–∞–≤—â–∏–∫",
            TESTER: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –¢–µ—Å—Ç–µ—Ä",
            SAMPLES: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ü—Ä–æ–±–Ω–∏–∫–∏",
            STOCKS: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏",
            NEW_PRICE_YEAR: "New –≥–æ–¥ –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∞",
          },
        },
        ORDER_STAGES_MENU: {
          TITLE: "üìä –°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑",
          ITEMS: {
            SORT_MANUFACTURER: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é",
            SORT_PRICE: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–∞–π—Å—É",
            STAGE_ALL: "1. –í—Å–µ –¥–∞–Ω–Ω—ã–µ",
            STAGE_ORDER: "2. –ó–∞–∫–∞–∑",
            STAGE_PROMOTIONS: "3. –ê–∫—Ü–∏–∏",
            STAGE_SET: "4. –ù–∞–±–æ—Ä",
            STAGE_PRICE: "5. –ü—Ä–∞–π—Å",
          },
        },
      },
      /** "–¢–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è" –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ MT. */
      OVERRIDES: {},
    },

    // ============================ –ü–†–û–ï–ö–¢ "HD" ============================
    HD: {
      /** –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–æ–≤, –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞. */
      PREFIX: "HD-",
      /** –ù–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Google Drive –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ HD. */
      DRIVE: {
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–ø–∏—Ä—Ç—ã / –°–æ–∑–¥–∞—Ç—å –ú–∞–∫–µ—Ç—ã —Å–ø–∏—Ä—Ç—ã */
        SPIRITS: {
        /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –ø–∞–ø–∫–∏ –¥–ª—è —Å–ø–∏—Ä—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ HD */ PARENT_FOLDER_ID:
            "1_ID_–ü–ê–ü–ö–ò_–°–ü–ò–†–¢–û–í_–î–õ–Ø_HD",
          /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID —à–∞–±–ª–æ–Ω–∞ –¥–ª—è —Å–ø–∏—Ä—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ HD */ TEMPLATE_DOC_ID:
            "1_ID_–®–ê–ë–õ–û–ù–ê_–°–ü–ò–†–¢–û–í_–î–õ–Ø_HD",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (353–ø–ø) / –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (353–ø–ø) */
        PROTOCOLS_353PP: {
          /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –ø–∞–ø–∫–∏ –¥–ª—è 353–ø–ø –ø—Ä–æ–µ–∫—Ç–∞ HD */ PARENT_FOLDER_ID:
            "1_ID_–ü–ê–ü–ö–ò_353–ü–ü_–î–õ–Ø_HD",
          /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID —à–∞–±–ª–æ–Ω–∞ –¥–ª—è 353–ø–ø –ø—Ä–æ–µ–∫—Ç–∞ HD */ TEMPLATE_DOC_ID:
            "1_ID_–®–ê–ë–õ–û–ù–ê_353–ü–ü_–î–õ–Ø_HD",
        },
        /** üî¨ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –î–° (353–ø–ø) */
        DS_LAYOUTS: {
          /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID —à–∞–±–ª–æ–Ω–∞ –∑–∞—è–≤–∫–∏ –î–° –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ HD */ TEMPLATE_DOC_ID:
            "1_ID_–®–ê–ë–õ–û–ù–ê_–ó–ê–Ø–í–ö–ò_–î–°_–î–õ–Ø_HD",
        },
        /** üìÑ –ò–Ω–≤–æ–π—Å—ã ‚Üí –°–æ–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã */
        INVOICES: {
          /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –ø–∞–ø–∫–∏-—Å–±–æ—Ä–Ω–∏–∫–∞ –∏–Ω–≤–æ–π—Å–æ–≤ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ HD */ COLLECTION_PARENT_FOLDER_ID:
            "1_ID_–ü–ê–ü–ö–ò_–ò–ù–í–û–ô–°–û–í_–î–õ–Ø_HD",
        },
      },
      /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ HD. */
      VALUES: {
        /** WARNING: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ HD */ LABORATORY_NAME:
          "–ù–ê–ó–í–ê–ù–ò–ï –õ–ê–ë–û–†–ê–¢–û–†–ò–ò –î–õ–Ø HD",
      },
      /** "–¢–æ—á–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è" –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ HD. */
      OVERRIDES: {},
    },
  };

  // =======================================================================================
  // –ë–õ–û–ö 5: –ö–ê–†–¢–ê –î–û–ö–£–ú–ï–ù–¢–û–í –ò –ê–í–¢–û–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–†–û–ï–ö–¢–ê
  // =======================================================================================
  const DOC_TO_PROJECT = {
  '13kB77R67GJOZQ3vsLcwR1nUaRsupR8ZnEaTdDd66CTQ': 'MT',
    "12yIL1CuESZxeUUd-oKK2brtN1FnXE9q95N7SqzNc7vk": "SS",
    "1CpYYLvRYslsyCkuLzL9EbbjsvbNpWCEZcmhKqMoX5zw": "SK",
    "1zSu0PzKKa5wvwMZCicwLN8N7Rwhs8XlJVrTrt2LMzQs": "SK",
    "1fMOjUE7oZV96fCY5j5rPxnhWGJkDqg-GfwPZ8jUVgPw": "MT",
    "1BW8Gk5_X2EZVjbnaa2yDm-bPzzlggwQrHepeNCcPCc0": "MT",
    "1w8Xddj3uSgXE_AmshWIzJoRKDQpZuqDkQFiCMX99DPk": "HD",
  };

  // =======================================================================================
  // –ë–õ–û–ö 6: –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–ë–û–†–ö–ê –û–ë–™–ï–ö–¢–ê CONFIG
  // =======================================================================================
  function _detectProjectKey() {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    if (!ss) {
      Logger.log(
        '–í–ù–ò–ú–ê–ù–ò–ï: –ó–∞–ø—É—Å–∫ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "' +
          SETTINGS.DEBUG_PROJECT_KEY +
          '" –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.'
      );
      return SETTINGS.DEBUG_PROJECT_KEY;
    }
    const currentDocumentId = ss.getId();
    const projectKey = DOC_TO_PROJECT[currentDocumentId];
    if (!projectKey) {
      const errorMsg = 'CRITICAL: Document ID ' + currentDocumentId + ' not found in DOC_TO_PROJECT. Using fallback "SS".';
      console.error(errorMsg);
      Logger.log(errorMsg);
      // Fallback to SS to prevent crash and allow menu to load
      return "SS"; 
    }
    return projectKey;
  }

  const activeProjectKey = _detectProjectKey();
  const activeProjectConfig = PROJECTS[activeProjectKey];
  if (!activeProjectConfig) {
      const errorMsg = 'CRITICAL: Configuration for project "' + activeProjectKey + '" not found.';
      console.error(errorMsg);
      // This should theoretically not happen if fallback is valid, but just in case:
      throw new Error(errorMsg);
  }

  function _extend(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      if (!source) continue;
      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }
    return target;
  }

  function _clone(value) {
    if (Array.isArray(value)) {
      return value.map(function (item) {
        return _clone(item);
      });
    }
    if (value && typeof value === 'object') {
      var result = {};
      for (var key in value) {
        if (Object.prototype.hasOwnProperty.call(value, key)) {
          result[key] = _clone(value[key]);
        }
      }
      return result;
    }
    return value;
  }

  function _deepFreeze(obj) {
    if (!obj || typeof obj !== 'object' || Object.isFrozen(obj)) {
      return;
    }
    Object.freeze(obj);
    Object.keys(obj).forEach(function (key) {
      var value = obj[key];
      if (value && typeof value === 'object' && !Object.isFrozen(value)) {
        _deepFreeze(value);
      }
    });
  }

  function _buildMenuRegistry(projectKey, projectConfig) {
    var registry = _clone(MENU_REGISTRY_BLUEPRINT);
    if (!Array.isArray(registry)) {
      return [];
    }

    var primaryDataGroup = _buildPrimaryDataMenuGroup(projectKey, projectConfig);
    if (primaryDataGroup) {
      // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É "–ó–∞–∫–∞–∑" –≤ –ù–ê–ß–ê–õ–û –º–µ–Ω—é (–ø–µ—Ä–≤–æ–π)
      registry.unshift(primaryDataGroup);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É "–°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑" –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ SK
    var orderStagesGroup = _buildOrderStagesMenuGroup(projectKey, projectConfig);
    if (orderStagesGroup) {
      // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –≥—Ä—É–ø–ø—ã "–ó–∞–∫–∞–∑"
      registry.splice(1, 0, orderStagesGroup);
    }

    return registry;
  }

  function _buildPrimaryDataMenuGroup(projectKey, projectConfig) {
    if (!projectConfig || !projectConfig.PRIMARY_DATA) {
      return null;
    }

    var cfg = projectConfig.PRIMARY_DATA;
    var menuCfg = cfg.MENU || {};
    var title = menuCfg.TITLE || "üßæ –ó–∞–∫–∞–∑";
    var itemsCfg = menuCfg.ITEMS || {};
    var items = [];

    for (var i = 0; i < PRIMARY_DATA_MENU_ORDER.length; i++) {
      var key = PRIMARY_DATA_MENU_ORDER[i];
      var label = itemsCfg[key];
      if (!label) {
        continue;
      }

      var actionDef = PRIMARY_DATA_MENU_ACTIONS[key];
      if (!actionDef) {
        continue;
      }

      var item = { label: label };

      if (actionDef.fnByProject) {
        if (!actionDef.fnByProject[projectKey]) {
          continue;
        }
        item.fnByProject = _clone(actionDef.fnByProject);
      } else if (actionDef.fn) {
        item.fn = actionDef.fn;
      } else {
        continue;
      }

      if (actionDef.onlyForProjects) {
        item.onlyForProjects = Array.isArray(actionDef.onlyForProjects)
          ? actionDef.onlyForProjects.slice()
          : _clone(actionDef.onlyForProjects);
      }

      items.push(item);
    }

    if (!items.length) {
      return null;
    }

    return { title: title, items: items };
  }

  function _buildOrderStagesMenuGroup(projectKey, projectConfig) {
    // –≠—Ç–∞ –≥—Ä—É–ø–ø–∞ –º–µ–Ω—é –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å PRIMARY_DATA
    if (!projectConfig || !projectConfig.PRIMARY_DATA) {
      return null;
    }

    var cfg = projectConfig.PRIMARY_DATA;
    var stagesCfg = cfg.ORDER_STAGES_MENU || {};
    var title = stagesCfg.TITLE || "üìä –°—Ç–∞–¥–∏–∏ –ø–æ –∑–∞–∫–∞–∑";
    var itemsCfg = stagesCfg.ITEMS || {};
    var items = [];

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º ORDER_STAGES_MENU_ORDER –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—é
    // –ü–æ—Ä—è–¥–æ–∫: —Å–Ω–∞—á–∞–ª–∞ –∫–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–±–µ–∑ –Ω–æ–º–µ—Ä–æ–≤), –∑–∞—Ç–µ–º —Å—Ç–∞–¥–∏–∏ (—Å –Ω–æ–º–µ—Ä–∞–º–∏)
    for (var i = 0; i < ORDER_STAGES_MENU_ORDER.length; i++) {
      var key = ORDER_STAGES_MENU_ORDER[i];
      var label = itemsCfg[key];
      if (!label) {
        continue;
      }

      var actionDef = PRIMARY_DATA_MENU_ACTIONS[key];
      if (!actionDef) {
        continue;
      }

      var item = { label: label };

      if (actionDef.fnByProject) {
        if (!actionDef.fnByProject[projectKey]) {
          continue;
        }
        item.fnByProject = _clone(actionDef.fnByProject);
      } else if (actionDef.fn) {
        item.fn = actionDef.fn;
      } else {
        continue;
      }

      if (actionDef.onlyForProjects) {
        item.onlyForProjects = Array.isArray(actionDef.onlyForProjects)
          ? actionDef.onlyForProjects.slice()
          : _clone(actionDef.onlyForProjects);
      }

      items.push(item);
    }

    if (!items.length) {
      return null;
    }

    return { title: title, items: items };
  }

  // AUTOMATION config removed - now using standalone library
  const CONFIG = {
    VERSION: "2.2",
    ACTIVE_PROJECT_KEY: activeProjectKey,
    SETTINGS: _extend({}, SETTINGS, { BRAND_PREFIX: activeProjectConfig.PREFIX }),
    SHEETS: _extend({}, SHEETS),
    HEADERS: _extend({}, HEADERS),
    MENU_REGISTRY: _buildMenuRegistry(activeProjectKey, activeProjectConfig),
    DRIVE: {
      SPIRITS: _extend({}, activeProjectConfig.DRIVE.SPIRITS),
      PROTOCOLS_353PP: _extend(
        {},
        DRIVE_STRUCTURE_PATTERNS.PROTOCOLS_353PP,
        activeProjectConfig.DRIVE.PROTOCOLS_353PP
      ),
      DS_LAYOUTS: _extend(
        {},
        DRIVE_STRUCTURE_PATTERNS.DS_LAYOUTS,
        activeProjectConfig.DRIVE.DS_LAYOUTS
      ),
      DOC_STRUCTURING: _extend({}, DRIVE_STRUCTURE_PATTERNS.DOC_STRUCTURING),
      INVOICE_DESCRIPTION: _extend({}, DRIVE_STRUCTURE_PATTERNS.INVOICE_DESCRIPTION),
      INVOICES: _extend({}, activeProjectConfig.DRIVE.INVOICES),
    },
    VALUES: _extend({}, VALUES, activeProjectConfig.VALUES),
    PRIMARY_DATA: activeProjectConfig.PRIMARY_DATA ? _clone(activeProjectConfig.PRIMARY_DATA) : null,
    OVERRIDES: _extend({ onUpdate: 'onUpdateOverride' }, activeProjectConfig.OVERRIDES),
    CASCADE_RULES: _extend({}, CASCADE_RULES, activeProjectConfig.CASCADE_RULES),
    COLUMNS: _extend({}, COLUMNS),
    COLUMNS: _extend({}, COLUMNS),
    getHeaders: function (sheetName) {
      var headers = this.HEADERS[sheetName] || [];
      return headers.slice();
    },
  };

  // "–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ–º" –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
  Object.freeze(CONFIG);
  Object.freeze(CONFIG.SETTINGS);
  Object.freeze(CONFIG.SHEETS);
  Object.keys(CONFIG.HEADERS).forEach((key) =>
    Object.freeze(CONFIG.HEADERS[key])
  );
  Object.freeze(CONFIG.HEADERS);
  _deepFreeze(CONFIG.MENU_REGISTRY);
  Object.freeze(CONFIG.MENU_REGISTRY);
  Object.freeze(CONFIG.DRIVE);
  Object.keys(CONFIG.DRIVE).forEach((key) => {
    if (typeof CONFIG.DRIVE[key] === "object") Object.freeze(CONFIG.DRIVE[key]);
  });
  if (CONFIG.PRIMARY_DATA) {
    _deepFreeze(CONFIG.PRIMARY_DATA);
  }
  Object.freeze(CONFIG.VALUES);
  Object.freeze(CONFIG.OVERRIDES);
  Object.freeze(CONFIG.CASCADE_RULES);
  Object.keys(CONFIG.CASCADE_RULES).forEach((key) =>
    Object.freeze(CONFIG.CASCADE_RULES[key])
  );
  Object.freeze(CONFIG.COLUMNS);
  Object.keys(CONFIG.COLUMNS).forEach((key) =>
    Object.freeze(CONFIG.COLUMNS[key])
  );
  Object.freeze(CONFIG.COLUMNS);
  Object.keys(CONFIG.COLUMNS).forEach((key) =>
    Object.freeze(CONFIG.COLUMNS[key])
  );

  // =======================================================================================
  // –ë–õ–û–ö 7: –ö–û–ù–°–¢–†–£–ö–¢–û–† –ú–ï–ù–Æ
  // ---------------------------------------------------------------------------------------
  // –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –∏–∑ C_ApiMenu.gs (02Menu.js) –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é
  // =======================================================================================

  /**
   * –§—É–Ω–∫—Ü–∏—è onOpen - —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
   */
  function _onOpen() {
    const registry = CONFIG.MENU_REGISTRY;
    _createMenusFromRegistry(registry);
  }

  function _createMenusFromRegistry(registry) {
    try {
      const ui = SpreadsheetApp.getUi();
      const activeProjectKey = CONFIG.ACTIVE_PROJECT_KEY || null;
      registry.forEach((group) => {
        if (
          group.onlyForProjects &&
          (!activeProjectKey || group.onlyForProjects.indexOf(activeProjectKey) === -1)
        ) {
          return;
        }
        let menu = ui.createMenu(group.title);
        _buildMenuItems(ui, menu, group.items);
        menu.addToUi();
      });
    } catch (e) {
      console.error(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–µ–Ω—é: ${e.stack}`);
    }
  }

  function _buildMenuItems(ui, menu, items) {
    const activeProjectKey = CONFIG.ACTIVE_PROJECT_KEY || null;
    items.forEach((item) => {
      if (item.separator) {
        menu.addSeparator();
      } else if (item.submenu) {
        let subMenu = ui.createMenu(item.submenu);
        _buildMenuItems(ui, subMenu, item.items);
        menu.addSubMenu(subMenu);
      } else if (item.label && item.fn) {
        if (
          item.onlyForProjects &&
          item.onlyForProjects.indexOf(CONFIG.ACTIVE_PROJECT_KEY || null) === -1
        ) {
          return;
        }
        var targetFn = item.fn;
        const fnName =
          typeof targetFn === "string" && targetFn.endsWith("_proxy")
            ? targetFn
            : `${targetFn}_proxy`;
        menu.addItem(item.label, fnName);
      } else if (item.label && item.fnByProject) {
        const targetFn = item.fnByProject[activeProjectKey];
        if (!targetFn) {
          return;
        }
        const fnName =
          typeof targetFn === "string" && targetFn.endsWith("_proxy")
            ? targetFn
            : `${targetFn}_proxy`;
        menu.addItem(item.label, fnName);
      }
    });
  }

  // =======================================================================================
  // –ë–õ–û–ö 8: –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –° –≠–ú–û–î–ó–ò
  // =======================================================================================

  /**
   * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —ç–º–æ–¥–∑–∏ –∏ –∑–∞–ø–∏—Å—å—é –≤ "–ñ—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ"
   *
   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   * @param {string} level - –£—Ä–æ–≤–µ–Ω—å: DEBUG | INFO | WARN | ERROR
   * @param {string} emoji - –≠–º–æ–¥–∑–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
   * @param {string} functionName - –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   * @param {string} details - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   */
  function logWithEmoji(message, level, emoji, functionName, details) {
    level = level || 'INFO';
    emoji = emoji || _getEmojiForMessage(message, level);
    functionName = functionName || '';
    details = details || '';

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    const currentLevel = SETTINGS.CURRENT_LOG_LEVEL;
    const messageLevelValue = SETTINGS.LOG_LEVELS[level] || 1;

    if (messageLevelValue < currentLevel) {
      return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ª–æ–≥–∏ –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    }

    // –§–æ—Ä–º–∞—Ç: timestamp, level, emoji + message, function, details
    const timestamp = Utilities.formatDate(
      new Date(),
      SETTINGS.TIMEZONE,
      'yyyy-MM-dd HH:mm:ss'
    );

    const fullMessage = emoji + ' ' + message;

    // 1. –õ–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª—å
    Logger.log(`[${timestamp}] ${level}: ${fullMessage}`);

      // 2. –õ–æ–≥ –≤ Google Sheets
    try {
      const ss = SpreadsheetApp.getActiveSpreadsheet();
      if (!ss) return;

      // –õ–û–ì–ò–ö–ê –†–ê–ó–î–ï–õ–ï–ù–ò–Ø –ñ–£–†–ù–ê–õ–û–í:
      // "–ñ—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ" (SHEETS.LOG) - –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ Lib.logSynchronization
      // General logs (logWithEmoji) —Ç—É–¥–∞ –±–æ–ª—å—à–µ –ù–ï –ø–∏—à—É—Ç.

      // –ë) "–ñ—É—Ä–Ω–∞–ª –ª–æ–≥–æ–≤" (SHEETS.LOG_DEBUG) - –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ª–æ–≥ (–í–°–Å: DEBUG + INFO + ...)
      // –ü–∏—à–µ–º —Å—é–¥–∞ –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è.
      if (SHEETS.LOG_DEBUG) {
        const debugSheet = ss.getSheetByName(SHEETS.LOG_DEBUG);
        if (debugSheet) {
          debugSheet.appendRow([timestamp, level, fullMessage, functionName, details]);
        }
      }

    } catch (e) {
      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–∏—Å—Ç, –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–∏—Å—Ç –ª–æ–≥–æ–≤:', e.message);
    }
  }

  /**
   * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ —É—Ä–æ–≤–Ω—è
   */
  function _getEmojiForMessage(message, level) {
    const lowerMessage = message.toLowerCase();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
    const emojiMap = {
      '–∑–∞–ø—É—â–µ–Ω': 'üöÄ',
      '–Ω–∞—á–∞–ª–æ': 'üöÄ',
      'start': 'üöÄ',
      '–æ–±—Ä–∞–±–æ—Ç–∫–∞': '‚è≥',
      'processing': '‚è≥',
      '–ø–æ–ª—É—á–µ–Ω–∏–µ': 'üì•',
      '–∑–∞–≥—Ä—É–∑–∫–∞': 'üì•',
      'download': 'üì•',
      '—É—Å–ø–µ—à–Ω–æ': '‚úÖ',
      'success': '‚úÖ',
      '–≥–æ—Ç–æ–≤–æ': '‚úÖ',
      'done': '‚úÖ',
      '–∑–∞–ø–∏—Å—å': '‚úèÔ∏è',
      'write': '‚úèÔ∏è',
      '—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ': '‚úèÔ∏è',
      'save': '‚úèÔ∏è',
      '–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ': '‚ö†Ô∏è',
      'warning': '‚ö†Ô∏è',
      '–≤–Ω–∏–º–∞–Ω–∏–µ': '‚ö†Ô∏è',
      '–æ—à–∏–±–∫–∞': '‚ùå',
      'error': '‚ùå',
      'fail': '‚ùå',
      '–∑–∞–≤–µ—Ä—à–µ–Ω': 'üèÅ',
      'finish': 'üèÅ',
      'complete': 'üèÅ',
      '—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è': 'üîÑ',
      'sync': 'üîÑ',
      '–≤—ã–≥—Ä—É–∑–∫–∞': 'üì§',
      'upload': 'üì§',
      'export': 'üì§',
      '—É–¥–∞–ª–µ–Ω–∏–µ': 'üóëÔ∏è',
      'delete': 'üóëÔ∏è',
      '—Å–æ–∑–¥–∞–Ω–∏–µ': '‚ûï',
      'create': '‚ûï',
      'add': '‚ûï',
      'debug': 'üêõ',
      '–æ—Ç–ª–∞–¥–∫–∞': 'üêõ'
    };

    for (const [keyword, emoji] of Object.entries(emojiMap)) {
      if (lowerMessage.includes(keyword)) {
        return emoji;
      }
    }

    // Fallback –ø–æ —É—Ä–æ–≤–Ω—é
    const levelEmojis = {
      'DEBUG': 'üêõ',
      'INFO': '‚ÑπÔ∏è',
      'WARN': '‚ö†Ô∏è',
      'ERROR': '‚ùå'
    };

    return levelEmojis[level] || '‚ÑπÔ∏è';
  }

  // –î–µ–ª–∞–µ–º CONFIG –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
  global.Lib = global.Lib || {};
  global.Lib.CONFIG = CONFIG;
  global.Lib.onOpen = _onOpen;
  global.Lib.logWithEmoji = logWithEmoji; // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  global.CONFIG = CONFIG;
  global.logWithEmoji = logWithEmoji; // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
})(this);
